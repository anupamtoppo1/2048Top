<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2048 Purple Edition</title>
    <style>
        :root {
            --bg-purple: #a547d6;
            --grid-bg: #111111;
            /* Tile Colors based on your image */
            --t2: #9e00ff; --t4: #f42c5c; --t8: #ffca28; --t16: #00cd01;
            --t32: #0095e0; --t64: #c2175b; --t128: #ff6d00; --t256: #1de9b6;
            --t2048: #4a148c;
        }

        * { box-sizing: border-box; -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; }

        body {
            background-color: var(--bg-purple);
            font-family: 'Arial', sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            height: 100vh;
            overflow: hidden;
            touch-action: none; /* Prevents mobile browser from scrolling while swiping tiles */
        }

        /* Header UI */
        .header {
            width: 90%;
            max-width: 400px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
        }

        .score-row { display: flex; gap: 10px; }

        .stat-box {
            background: #000000;
            border-radius: 4px;
            padding: 5px 15px;
            min-width: 90px;
            text-align: center;
            color: white;
        }

        .stat-label { font-size: 11px; color: #b388ff; font-weight: bold; letter-spacing: 1px; }
        .stat-value { font-size: 22px; font-weight: bold; }

        .menu-btn { font-size: 32px; color: black; cursor: pointer; line-height: 0.8; }

        /* Game Board - Responsive */
        .board-container {
            position: relative;
            width: 90vw;
            height: 90vw;
            max-width: 400px;
            max-height: 400px;
            background-color: var(--grid-bg);
            border: 8px solid var(--grid-bg);
            border-radius: 8px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 8px;
        }

        .tile {
            width: 100%;
            height: 100%;
            background: #222;
            border-radius: 4px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 28px;
            font-weight: bold;
            color: white;
            transition: all 0.1s ease-in-out;
        }

        /* Tile Styling */
        .tile[data-val="2"] { background: var(--t2); }
        .tile[data-val="4"] { background: var(--t4); }
        .tile[data-val="8"] { background: var(--t8); }
        .tile[data-val="16"] { background: var(--t16); }
        .tile[data-val="32"] { background: var(--t32); }
        .tile[data-val="64"] { background: var(--t64); }
        .tile[data-val="128"] { background: var(--t128); font-size: 24px; }
        .tile[data-val="256"] { background: var(--t256); font-size: 24px; }
        .tile[data-val="2048"] { background: var(--t2048); font-size: 22px; }

        /* Audio Controls */
        .audio-controls {
            margin-top: 30px;
            background: rgba(0,0,0,0.4);
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            cursor: pointer;
            border: none;
            font-weight: bold;
        }

        #game-over-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            border-radius: 4px;
        }
    </style>
</head>
<body>

    <div class="header">
        <div class="score-row">
            <div class="stat-box">
                <div class="stat-label">SCORE</div>
                <div id="score" class="stat-value">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">BEST</div>
                <div id="best" class="stat-value">0</div>
            </div>
        </div>
        <div class="menu-btn">‚â°</div>
    </div>

    <div class="board-container" id="board">
        <div id="game-over-overlay">
            <h1 style="color:white">Game Over!</h1>
            <button onclick="resetGame()" style="padding:10px 20px; cursor:pointer">Restart</button>
        </div>
    </div>

    <button class="audio-controls" id="audioBtn">üéµ PLAY MUSIC</button>
    <audio id="bgMusic" loop src="song.mp3"></audio>

    <script>
        let grid = [];
        let score = 0;
        let bestScore = localStorage.getItem('2048-best-purple') || 0;
        const size = 4;
        const boardEl = document.getElementById('board');
        const audio = document.getElementById('bgMusic');
        const audioBtn = document.getElementById('audioBtn');

        // Initial Setup
        function init() {
            grid = Array(size).fill().map(() => Array(size).fill(0));
            score = 0;
            document.getElementById('best').innerText = bestScore;
            addTile(); addTile();
            render();
        }

        function addTile() {
            let empty = [];
            for(let r=0; r<size; r++) for(let c=0; c<size; c++) if(grid[r][c]===0) empty.push({r,c});
            if(empty.length) {
                let {r,c} = empty[Math.floor(Math.random()*empty.length)];
                grid[r][c] = Math.random() > 0.1 ? 2 : 4;
            }
        }

        function render() {
            // Clear existing tiles (keeping the overlay)
            const oldTiles = document.querySelectorAll('.tile');
            oldTiles.forEach(t => t.remove());

            for(let r=0; r<size; r++) {
                for(let c=0; c<size; c++) {
                    let tile = document.createElement('div');
                    tile.className = 'tile';
                    if(grid[r][c] !== 0) {
                        tile.innerText = grid[r][c];
                        tile.setAttribute('data-val', grid[r][c]);
                    }
                    boardEl.appendChild(tile);
                }
            }
            document.getElementById('score').innerText = score;
            if(score > bestScore) {
                bestScore = score;
                document.getElementById('best').innerText = bestScore;
                localStorage.setItem('2048-best-purple', bestScore);
            }
        }

        // Logic - Move & Merge
        function slide(row) {
            let filtered = row.filter(x => x !== 0);
            for(let i=0; i<filtered.length-1; i++) {
                if(filtered[i] === filtered[i+1]) {
                    filtered[i] *= 2;
                    score += filtered[i];
                    filtered.splice(i+1, 1);
                }
            }
            while(filtered.length < size) filtered.push(0);
            return filtered;
        }

        function move(dir) {
            let prev = JSON.stringify(grid);
            if(dir === 'Left' || dir === 'Right') {
                for(let r=0; r<size; r++) {
                    let row = grid[r];
                    if(dir === 'Right') row.reverse();
                    row = slide(row);
                    if(dir === 'Right') row.reverse();
                    grid[r] = row;
                }
            } else {
                for(let c=0; c<size; c++) {
                    let col = [grid[0][c], grid[1][c], grid[2][c], grid[3][c]];
                    if(dir === 'Down') col.reverse();
                    col = slide(col);
                    if(dir === 'Down') col.reverse();
                    for(let r=0; r<size; r++) grid[r][c] = col[r];
                }
            }
            if(prev !== JSON.stringify(grid)) {
                addTile();
                render();
                checkGameOver();
            }
        }

        // Game Over Check
        function checkGameOver() {
            let movesPossible = false;
            for(let r=0; r<size; r++) {
                for(let c=0; c<size; c++) {
                    if(grid[r][c] === 0) movesPossible = true;
                    if(c<3 && grid[r][c] === grid[r][c+1]) movesPossible = true;
                    if(r<3 && grid[r][c] === grid[r+1][c]) movesPossible = true;
                }
            }
            if(!movesPossible) document.getElementById('game-over-overlay').style.display = 'flex';
        }

        function resetGame() {
            document.getElementById('game-over-overlay').style.display = 'none';
            init();
        }

        // --- CONTROLS ---

        // 1. PC Controls (Arrows)
        window.addEventListener('keydown', e => {
            if(e.key.includes('Arrow')) move(e.key.replace('Arrow',''));
        });

        // 2. Mobile Controls (Swipe)
        let startX, startY;
        document.addEventListener('touchstart', e => {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
        }, {passive: false});

        document.addEventListener('touchend', e => {
            let diffX = startX - e.changedTouches[0].clientX;
            let diffY = startY - e.changedTouches[0].clientY;
            if(Math.abs(diffX) > Math.abs(diffY)) {
                if(Math.abs(diffX) > 30) move(diffX > 0 ? 'Left' : 'Right');
            } else {
                if(Math.abs(diffY) > 30) move(diffY > 0 ? 'Up' : 'Down');
            }
        });

        // 3. Audio Control
        audioBtn.onclick = () => {
            if(audio.paused) {
                audio.play();
                audioBtn.innerText = "‚è∏ PAUSE MUSIC";
            } else {
                audio.pause();
                audioBtn.innerText = "üéµ PLAY MUSIC";
            }
        };

        init();
    </script>
</body>
</html>
